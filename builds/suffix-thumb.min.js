!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("efrt")):"function"==typeof define&&define.amd?define(["exports","efrt"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).suffixThumb={},e.efrt)}(this,(function(e,t){"use strict";const n=function(e="",t={}){let n=function(e,t={}){return t.hasOwnProperty(e)?t[e]:null}(e,t.ex);return n=n||function(e,t=[]){for(let n=0;n<t.length;n+=1)if(e.endsWith(t[n]))return e;return null}(e,t.same),n=n||function(e,t,n={}){t=t||{};for(let r=e.length-1;r>=1;r-=1){let l=e.length-r,o=e.substring(l,e.length);if(!0===t.hasOwnProperty(o))return e.slice(0,l)+t[o];if(!0===n.hasOwnProperty(o))return e.slice(0,l)+n[o]}return t.hasOwnProperty("")?e+t[""]:n.hasOwnProperty("")?e+n[""]:null}(e,t.fwd,t.both),n=n||e,n},r=function(e){return Object.entries(e).reduce(((e,t)=>(e[t[1]]=t[0],e)),{})},l=function(e={}){return{reversed:!0,both:r(e.both),ex:r(e.ex),fwd:e.rev||{}}},o=function(e,t={}){let n=new Set,r=new Set;return e=e.filter((e=>!n.has(e[0])&&(!r.has(e[1])&&(n.add(e[0]),r.add(e[1]),!0))))},u=function(e,t=0){let n=[],[r,l]=e;for(let e=0;e<r.length&&r[e]===l[e];e+=1)n.push(r[e]);let o=n.length-t;return t>=n.length?null:{from:r.substring(o),to:l.substring(o)}},i=(e,t)=>{if(0===t)return 100;let n=e/t*100;return n=Math.round(10*n)/10,n},f=function(e,t){let n=0,r=new Set;return e?0===t.length?{total:n,percent:100,rule:e,clear:r,count:0}:(t.forEach((t=>{let l=function(e,t){if(t.from.length>=e.length)return null;if(e.endsWith(t.from)){let n=e.length-t.from.length;return e.slice(0,n)+t.to}return null}(t[0],e);null!==l&&(n+=1,l===t[1]&&r.add(t[0]))})),{total:n,count:r.size,percent:i(r.size,n),rule:e,clear:r}):{total:n,percent:0,rule:e,clear:r,count:0}},s=function(e,t,n){let r=e.slice(0),l={};for(let e=0;e<6;e+=1)for(let o=0;o<r.length;o+=1){let i=u(r[o],e),s=f(i,r);if(s.rule&&s.percent>n.threshold&&s.count>n.min){if(f(i,t).percent<100)continue;l[i.from]=i.to,r=r.filter((e=>!s.clear.has(e[0])||(t.push(e),!1)))}}return{rules:l,pending:r,finished:t}},c={threshold:80,min:0},h=e=>[e[1],e[0]];const a=function(e={}){let n={};return Object.keys(e).forEach((t=>{let r=function(e,t){let n=((e,t)=>{let n=[];for(let r=0;r<e.length&&e[r]===t[r];r+=1)n.push(e[r]);return n.join("")})(e,t);return n.length<1?t:n.length+t.substr(n.length)}(t,e[t]);n[t]=r})),t.pack(n)},d=e=>[e[1],e[0]],p=function(e,t){let r=0;return e.forEach((e=>{let l=n(e[0],t);l===e[1]?r+=1:console.log("❌ ",e,"→ "+l)})),((e,t)=>{let n=e/t*100;return n=Math.round(10*n)/10,n+"%"})(r,e.length)};e.compress=function(e){return{fwd:a(e.fwd),both:a(e.both),rev:a(e.rev),ex:a(e.ex)}},e.convert=n,e.learn=function(e,t={}){t=Object.assign({},c,t);let n={},r={};e=function(e,t){return(e=o(e)).filter((e=>{let[n,r]=e;return n.substring(0,1)===r.substring(0,1)||(t[n]=r,!1)}))}(e,n);let{rules:l,pending:u,finished:i}=s(e,[],t),{fwd:a,both:d,revPairs:p}=function(e,t,n){let r={},l=t.slice(0),o=[];return Object.entries(e).reverse().forEach((u=>{let i={from:u[1],to:u[0]};if(!i.to)return;let s=f(i,t);s.percent>n.threshold&&(r[i.to]=i.from,delete e[i.to],l=l.filter((e=>!s.clear.has(e[0])||(o.push(e),!1))))})),{fwd:e,both:r,revPairs:{pending:l,finished:o}}}(l,e.map(h),t),g=[];if(!1!==t.reverse){let e=s(p.pending,p.finished,t);g=e.pending,r=e.rules}return t.min<=1&&(u.forEach((e=>{n[e[0]]=e[1]})),g.forEach((e=>{n[e[1]]=e[0]}))),{fwd:a,both:d,rev:r,ex:n}},e.reverse=l,e.test=function(e,t={}){e=o(e);let n=p(e,t),r=p(e.map(d),l(t));var u;console.log(`${u=n,"[34m"+u+"[0m"}  -  🔄 ${(e=>"[36m"+e+"[0m")(r)}`)},e.uncompress=function(e={}){return"string"==typeof e&&(e=JSON.parse(e)),e.fwd=t.unpack(e.fwd),e.both=t.unpack(e.both),e.bkwd=t.unpack(e.bkwd),e.ex=t.unpack(e.ex),e},e.validate=o,Object.defineProperty(e,"__esModule",{value:!0})}));
