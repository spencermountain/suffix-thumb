!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("efrt")):"function"==typeof define&&define.amd?define(["exports","efrt"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).suffixThumb={},e.efrt)}(this,(function(e,t){"use strict";const n=/^.([0-9]+)/,r=function(e,t){if(n=t.rules,"[object Array]"===Object.prototype.toString.call(n))return t.rules;var n;let r=e[e.length-1],o=t.rules[r]||[];return 0===o.length&&(o=t.rules[""]||o),o},o=function(e,t){if(t.exceptions.hasOwnProperty(e))return function(e,t){let r=t.exceptions[e],o=r.match(n);if(null===o)return t.exceptions[e];let s=Number(o[1])||0;return e.substr(0,s)+r.replace(n,"")}(e,t);const o=r(e,t);for(let t=0;t<o.length;t+=1){let n=o[t][0];if(e.endsWith(n)){let r=new RegExp(n+"$");return e.replace(r,o[t][1])}}return e},s=function(e=""){let t=[];for(let n=6;n>=0;n-=1){if(e.length-1<=n)continue;let r=e.length-n-1,o=e.substring(r,r+e.length-1);t.push(o)}return t},c=function(e){let t=[];return Object.keys(e).forEach((n=>{let r=function(e,t){let n=Object.keys(e).map((n=>({from:t,to:n,yes:e[n]})));return n=n.sort(((e,t)=>e.yes>t.yes?-1:e.yes<t.yes?1:0)),n}(e[n],n);r[0]&&r[0].yes>1&&t.push(r[0])})),t=t.sort(((e,t)=>e.yes>t.yes?-1:e.yes<t.yes?1:0)),t},l=function(e,t){let n=function(e,t){return e.map((e=>{let n=0,r=0,o={};return t.forEach((t=>{if(t[0].endsWith(e.from)){let s=new RegExp(e.from+"$");t[0].replace(s,e.to)===t[1]?n+=1:(r+=1,o[t[0]]=t[1])}})),{from:e.from,to:e.to,yes:n,no:r,percent:n/(n+r),exceptions:o}}))}(e,t);return n=n.filter((e=>e.yes>1&&e.yes>e.no)),n=n.sort(((e,t)=>e.yes>t.yes?-1:e.yes<t.yes?1:0)),n};function u(e){return e.split("").reverse().join("")}const i=function(e,t){let n={};return e.forEach((e=>{Object.assign(n,e.exceptions)})),e=function(e){return(e=e.sort(((e,t)=>e.from.length>t.from.length?-1:e.from.length<t.from.length||(e=u(e.from))>(t=u(t.from))?1:e<t?-1:0))).map((e=>[e.from,e.to]))}(e),t.filter((t=>!n.hasOwnProperty(t[0])&&!e.find((e=>t[0].endsWith(e.from))))).forEach((e=>{n[e[0]]=e[1]})),{rules:e,exceptions:n}},f=function(e){const t=function(e){const t={};return e.forEach((e=>{let[n,r]=e,o=s(n);o.push(""),o.forEach((e=>{t[e]=t[e]||{},s(r).forEach((n=>{t[e][n]=t[e][n]||0,t[e][n]+=1}))}))})),t}(e=e.filter((e=>e&&e[0]&&e[1])));let n=c(t),r=l(n,e);return r=function(e){let t={};return e.forEach(((n,r)=>{e.slice(r+1,e.length).forEach((e=>{e.from.endsWith(n.from)&&0===e.no&&(t[e.from]=!0)}))})),e=e.filter((e=>!1===t.hasOwnProperty(e.from)))}(r),i(r,e)},p=function(e){return e.exceptions=function(e){let t={},{rules:n,exceptions:r}=e;return Object.keys(r).forEach((e=>{let o=n.find((t=>e.endsWith(t[0])));o?e.replace(o[0],o[1])!==r[e]&&(t[e]=r[e]):t[e]=r[e]})),t}(e),e},h=function(e){let t={};return e.forEach((e=>{let n=e[0]||"",r=n[n.length-1]||"";t[r]=t[r]||[],t[r].push(e)})),t},a=function(e){return e=e.sort(((e,t)=>e[0].length>t[0].length?-1:e[0].length<t[0].length?1:0))},g=function(e,t,n){return e=p(e),!1!==n.inverse&&(e=function(e,t){let n=Object.assign({},e);n.rules=h(e.rules);let r=E(n);return t.forEach((t=>{let[n,s]=t;o(s,r)!==n&&(e.exceptions[t[0]]=t[1])})),e}(e,t)),e},y=function(e,t={}){let n={},r={};return e=e.filter((e=>void 0!==n[e[0]]?(t.verbose&&(console.warn("Duplicate left side:"),console.log("  1.",[e[0],n[e[0]]]),console.log("  2.",e)),!1):void 0!==r[e[1]]?(t.verbose&&(console.warn("Duplicate right side:"),console.log("  1.",[r[e[1]],e[1]]),console.log("  2.",e)),!1===t.inverse):(n[e[0]]=e[1],r[e[1]]=e[0],!0)))},m=function(e){let t={};return Object.keys(e).forEach((n=>{let r=e[n],o=((e,t)=>{let n=[];for(let r=0;r<e.length&&e[r]===t[r];r+=1)n.push(e[r]);return n.join("")})(n,r);if(o.length<2)return void(t[n]=r);let s="."+o.length+r.substr(o.length);t[n]=s})),t},b=function(e){return e=(e=>e.reduce(((e,t)=>(e[t[0]]=t[1],e)),{}))(e=function(e){let t=[];return Object.keys(e).forEach((n=>{t=t.concat(e[n])})),t}(e)),e=m(e),e=t.pack(e)},d=/^.([0-9]+)/,x=function(e){return Object.keys(e).forEach((t=>{let n=e[t],r=n.match(d);if(null!==r){let o=Number(r[1])||0,s=t.substring(0,o)+n.replace(d,"");e[t]=s}})),e},E=function(e){let t=[];var n;return Object.keys(e.rules).forEach((n=>{t=t.concat(e.rules[n].map((e=>[e[1],e[0]])))})),t=a(t),{rules:h(t),exceptions:(n=e.exceptions,Object.entries(n).reduce(((e,t)=>(e[t[1]]=t[0],e)),{}))}};e.compress=function(e={}){return e.rules=b(e.rules),e.exceptions=m(e.exceptions),e.exceptions=t.pack(e.exceptions),e},e.convert=o,e.learn=function(e,t={}){e=y(e,t);let n=f(e);return n=g(n,e,t),n.rules=h(n.rules),n},e.reverse=E,e.uncompress=function(e={}){var n;return"string"==typeof e.exceptions&&(e.exceptions=t.unpack(e.exceptions),e.exceptions=x(e.exceptions)),"string"==typeof e.rules&&(e.rules=(n=e.rules,n=t.unpack(n),n=x(n),n=Object.entries(n),n=a(n),h(n))),e},e.validate=y,Object.defineProperty(e,"__esModule",{value:!0})}));
