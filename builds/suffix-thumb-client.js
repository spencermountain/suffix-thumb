const e=/^.([0-9]+)/,t=function(t,n,r){if(n.exceptions.hasOwnProperty(t))return r&&console.log("exception, ",t,n.exceptions[t]),function(t,n){let r=n.exceptions[t],l=r.match(e);if(null===l)return n.exceptions[t];let o=Number(l[1])||0;return t.substr(0,o)+r.replace(e,"")}(t,n);let l=n.rules;n.reversed&&(l=n.rev),l=function(e,t={}){let n=t[e[e.length-1]]||[];return t[""]&&(n=n.concat(t[""])),n}(t,l);for(let e=0;e<l.length;e+=1){let n=l[e][0];if(t.endsWith(n)){r&&console.log("rule, ",l[e]);let o=new RegExp(n+"$");return t.replace(o,l[e][1])}}return r&&console.log(" x - "+t),t},n=function(e,t={}){let n={},r={};return e=e.filter((e=>void 0!==n[e[0]]?(t.debug&&(console.warn("Duplicate left side:"),console.log("  1.",[e[0],n[e[0]]]),console.log("  2.",e)),!1):void 0!==r[e[1]]?(t.debug&&(console.warn("Duplicate right side:"),console.log("  1.",[r[e[1]],e[1]]),console.log("  2.",e)),!1===t.inverse):(n[e[0]]=e[1],r[e[1]]=e[0],!0)))},r=function(e){let t={};return e.forEach((e=>{let n=e[0]||"",r=n[n.length-1]||"";t[r]=t[r]||[],t[r].push(e)})),t},l=/^([0-9]+)/,o=function(e){const t=/\|/;return e.split(/,/).map((e=>{let n=e.split(t);return function(e="",t=""){let n=(t=String(t)).match(l);if(null===n)return[e,t];let r=Number(n[1])||0,o=e.substring(0,r);return[e,o+t.replace(l,"")]}(n[0],n[1])}))},s=function(e={}){return(e=Object.assign({},e)).rules=o(e.rules),e.rules=r(e.rules),e.rev=o(e.rev),e.rev=r(e.rev),e.exceptions=o(e.exceptions),e.exceptions=e.exceptions.reduce(((e,t)=>(e[t[0]]=t[1],e)),{}),e},u=function(e){let{rules:t,exceptions:n,rev:r}=e;var l;return l=n,n=Object.entries(l).reduce(((e,t)=>(e[t[1]]=t[0],e)),{}),{reversed:!Boolean(e.reversed),rules:t,exceptions:n,rev:r}},i=function(e,t){return t[e[e.length-1]]||[]},c=function(e,t,n){const r="Left",l="Right";if(t.exceptions.hasOwnProperty(e))return r;let o=Object.entries(t.exceptions);for(let t=0;t<o.length;t+=1)if(o[t][1]===e)return l;let s=i(e,t.rules);for(let t=0;t<s.length;t+=1)if(e.endsWith(s[t][0]))return r;s=i(e,t.rev);for(let t=0;t<s.length;t+=1)if(e.endsWith(s[t][0]))return l;s=i(e,t.rules);for(let t=0;t<s.length;t+=1)if(e.endsWith(s[t][1]))return l;s=i(e,t.rev);for(let t=0;t<s.length;t+=1)if(e.endsWith(s[t][1]))return r;return null};export{c as classify,t as convert,u as reverse,s as uncompress,n as validate};
