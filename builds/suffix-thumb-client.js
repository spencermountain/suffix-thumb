import{unpack as e}from"efrt";const t=/^.([0-9]+)/,r=function(e,t){if(r=t.rules,"[object Array]"===Object.prototype.toString.call(r))return t.rules;var r;let n=e[e.length-1],o=t.rules[n]||[];return 0===o.length&&(o=t.rules[""]||o),o},n=function(e,n){if(n.exceptions.hasOwnProperty(e))return function(e,r){let n=r.exceptions[e],o=n.match(t);if(null===o)return r.exceptions[e];let l=Number(o[1])||0;return e.substr(0,l)+n.replace(t,"")}(e,n);const o=r(e,n);for(let t=0;t<o.length;t+=1){let r=o[t][0];if(e.endsWith(r)){let n=new RegExp(r+"$");return e.replace(n,o[t][1])}}return e},o=function(e,t={}){let r={},n={};return e=e.filter((e=>void 0!==r[e[0]]?(t.verbose&&(console.warn("Duplicate left side:"),console.log("  1.",[e[0],r[e[0]]]),console.log("  2.",e)),!1):void 0!==n[e[1]]?(t.verbose&&(console.warn("Duplicate right side:"),console.log("  1.",[n[e[1]],e[1]]),console.log("  2.",e)),!1===t.inverse):(r[e[0]]=e[1],n[e[1]]=e[0],!0)))},l=function(e){let t={};return e.forEach((e=>{let r=e[0]||"",n=r[r.length-1]||"";t[n]=t[n]||[],t[n].push(e)})),t},c=function(e){return e=e.sort(((e,t)=>e[0].length>t[0].length?-1:e[0].length<t[0].length?1:0))},s=/^.([0-9]+)/,u=function(e){return Object.keys(e).forEach((t=>{let r=e[t],n=r.match(s);if(null!==n){let o=Number(n[1])||0,l=t.substring(0,o)+r.replace(s,"");e[t]=l}})),e},i=function(t={}){var r;return"string"==typeof t.exceptions&&(t.exceptions=e(t.exceptions),t.exceptions=u(t.exceptions)),"string"==typeof t.rules&&(t.rules=(r=t.rules,r=e(r),r=u(r),r=Object.entries(r),r=c(r),l(r))),t},p=function(e){let t=[];var r;return Object.keys(e.rules).forEach((r=>{t=t.concat(e.rules[r].map((e=>[e[1],e[0]])))})),t=c(t),{rules:l(t),exceptions:(r=e.exceptions,Object.entries(r).reduce(((e,t)=>(e[t[1]]=t[0],e)),{}))}};export{n as convert,p as reverse,i as uncompress,o as validate};
